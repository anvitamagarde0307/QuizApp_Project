var PaymentScreenPay=function(container,settings_purchase){var pane,page,header_title,footer,area_contact,area_select,area_store,report_error,report_notice,input_email,radioboxes_payment,cbox_remember,but_process,but_process_label,but_process_icon,but_loadform,but_loadform_label,but_loadform_icon,but_close,icon_loading,currency,logged_in,payment,timeout_order_validated,INSTANCE=new VSModule,PADDLE_FORM_TYPE="overlay",URL_PURCHASE_SETUP="/api/purchases/setup",URL_INVOICE_PPI="/api/invoice/ppi",URL_INVOICE_CART="/api/invoice/cart",URL_INVOICE_CUSTOMIZATION="/api/invoice/customization",REGEX_EMAIL=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,monitor_email=!1,order_token=null,link_account=!1;function setup(){var but_close;input_email=new VectorStock.FieldInput($('input[name="email"]',area_contact)),radioboxes_payment=new VectorStock.FieldRadioboxes($("ul.radiobuttons li",area_select)),cbox_remember=new VectorStock.FieldCheckbox($("#pay-remember-payment",area_store)),but_process=$("#pbox-but-process-card",footer),but_process_label=$(".label",but_process),but_loadform=$("#pbox-but-load-form",footer),but_loadform_label=$(".label",but_loadform),but_close=$('button[data-action="close"]',container),icon_loading&&icon_loading.remove(),radioboxes_payment.on("change",onPaymentSelect),but_process.on("click",payWithStoredCard),but_loadform.on("click",validateForm),but_close.on("click",close),INSTANCE.show()}function onPaymentSelect(type){container.attr("data-payment",type)}function displayLoadingState(){report_error&&(report_error.remove(),report_error=null),container.addClass("disabled"),input_email.disable(),radioboxes_payment.disable(),cbox_remember.disable(),but_process.prop("disabled",!0),but_process_label.data("label",but_process_label.html()).html("Processing&hellip;"),but_process_icon=$(".icon",but_process).loadingIcon(),but_loadform.prop("disabled",!0),but_loadform_label.data("label",but_loadform_label.html()).html("Loading&hellip;"),but_loadform_icon=$(".icon",but_loadform).loadingIcon(),but_close.hide(),INSTANCE.dispatchEvent("disable")}function revertLoadingState(){container.removeClass("disabled"),input_email.enable(),cbox_remember.enable(),radioboxes_payment.enable(),but_process.prop("disabled",!1),but_process_label.html(but_process_label.data("label")),but_process_icon&&but_process_icon.remove(),but_loadform.prop("disabled",!1),but_loadform_label.html(but_loadform_label.data("label")),but_loadform_icon&&but_loadform_icon.remove(),but_close.show(),INSTANCE.dispatchEvent("enable")}function validateEmail(value){return value.match(REGEX_EMAIL)?(input_email.clearError(),!0):(input_email.showError("Enter a valid email"),input_email.focus(),monitor_email||(input_email.on("change",validateEmail),monitor_email=!0),!1)}function validateForm(){var invoice_url,invoice_params,is_validated=!0;(is_validated=logged_in?is_validated:validateEmail(input_email.value))&&(displayLoadingState(),invoice_url=getFormURL(),(invoice_params=getFormParams()).store_card=cbox_remember.checked?1:0,$.post(invoice_url,invoice_params).done(function(response){var url,checkout_config;response.success?(order_token=response.token,link_account=response.link_account,url=response.url,checkout_config="inline"===PADDLE_FORM_TYPE?{method:"inline",allowQuantity:!1,override:url,frameTarget:"pbox_paddle_form",frameInitialHeight:"100%",frameStyle:"width:100%; min-width:312px; background-color: transparent; border: none;",loadCallback:function(){}}:{method:"overlay",allowQuantity:!1,override:url,loadCallback:function(){}},$('html[lang="de"]').length&&(checkout_config.locale="de"),Paddle.Checkout.open(checkout_config)):(displayError("Failed to initiate payment","We could not connect with our payment provider - please try again."),revertLoadingState(),VectorStock.log({source:"PaymentBox",provider:"Paddle",issue:"Failed to setup Paddle invoice",detail:{url:invoice_url,params:invoice_params,response:response}}))}).fail(function(jqXHR,textStatus,errorThrown){displayError("Failed to load payment","We could not load our payment provider - please try again."),revertLoadingState(),VectorStock.log({source:"PaymentBox",provider:"Paddle",issue:"Paddle invoice setup failed to load",detail:{params:invoice_params,error:textStatus}})}))}function displayError(title,description){report_error&&report_error.remove(),report_error=$('<div class="report report_error" />').prependTo(page),$("<h6>"+title+"</h6>").appendTo(report_error),$("<p>"+description+"</p>").appendTo(report_error)}function displayNotice(title,description){report_notice&&report_notice.remove(),report_notice=$('<div class="report report_notice" />').prependTo(page),$("<h6>"+title+"</h6>").appendTo(report_notice),$("<p>"+description+"</p>").appendTo(report_notice)}function getFormURL(){return settings_purchase.customization?URL_INVOICE_CUSTOMIZATION:settings_purchase.image?URL_INVOICE_PPI:URL_INVOICE_CART}function getFormParams(){var invoice_params={};return settings_purchase.image&&(invoice_params.vector=settings_purchase.image.id,invoice_params.license=settings_purchase.image.license),logged_in||(invoice_params.email=input_email.value),settings_purchase.customization&&(invoice_params.asset_method=settings_purchase.image.payment||"existing"),invoice_params}function payWithStoredCard(){displayLoadingState();var invoice_url=getFormURL(),invoice_params=getFormParams();invoice_params.use_token=1,$.post(invoice_url,invoice_params).done(function(response){response.success?(order_token=response.token,INSTANCE.validateOrder(response.order_id)):(displayError("Payment Declined","We could not complete payment using your stored card. Please try entering a new card instead."),revertLoadingState(),VectorStock.log({source:"PaymentBox",provider:"Paddle",issue:"Stored card declined",detail:{params:invoice_params,response:response}}))}).fail(function(jqXHR,textStatus,errorThrown){displayError("Failed to Process","We could not connect to the payment server. Please try entering a new card instead."),revertLoadingState(),VectorStock.log({source:"PaymentBox",provider:"Paddle",issue:"Stored card failed to process",detail:{params:invoice_params,error:textStatus}})})}function clearValidationTimeout(){timeout_order_validated&&(clearTimeout(timeout_order_validated),timeout_order_validated=null)}function close(){INSTANCE.close(),INSTANCE.dispatchEvent("close")}return INSTANCE.validating=!1,INSTANCE.show=function(){container.addClass("show")},INSTANCE.hide=function(){container.removeClass("show")},INSTANCE.updateTotalPrice=function(total_cost,currency_type){0<total_cost&&($("em",header_title).html(total_cost),$("abbr",header_title).html(currency_type))},INSTANCE.validateOrder=function(order_id){but_process_label.html("Validating payment&hellip;"),but_loadform_label.html("Validating payment&hellip;"),INSTANCE.validating=!0,function validateOrder(order_id,attempt_counter){attempt_counter=attempt_counter||0,clearValidationTimeout(),$.post("/api/invoice/check-validated",{order_id:order_id,token:order_token}).done(function(response){var params;response.success?(revertLoadingState(),params=[response,link_account],settings_purchase.image&&params.push(settings_purchase.image.license),INSTANCE.validating=!1,INSTANCE.dispatchEvent("purchase",params)):(5===attempt_counter?(displayNotice("Your payment is taking longer than usual.","If you wish, you can close this popup and continue browsing images. We will email you with a download link once your payment has been validated."),but_close.show(),INSTANCE.dispatchEvent("enable")):60<attempt_counter&&displayNotice("There is currently a delay in processing payments.","We will email you with a download link once your payment has been validated."),attempt_counter<=60&&(timeout_order_validated=setTimeout(function(){validateOrder(order_id,attempt_counter)},2e3),attempt_counter++))}).fail(function(jqXHR,textStatus,errorThrown){VectorStock.log({source:"PaymentBox",provider:"Paddle",issue:"Failed to load purchase order validation",detail:{order_id:order_id,error:textStatus}}),INSTANCE.validating=!1})}(order_id),INSTANCE.dispatchEvent("validate")},INSTANCE.revertLoadingState=revertLoadingState,INSTANCE.close=function(){clearValidationTimeout()},pane=$("> .panel .pane",container),$("> div",pane),header_title=$(".header h1",container),page=$("#pbox_details_card",container),area_contact=$("#pbox_payment_new_contact",page),area_select=$("#pbox_payment_card_select",page),(area_store=$("#pbox_payment_type_store",page)).remove(),footer=$(".footer",container),(but_close=$('button[data-action="close"]',container)).on("click",close),icon_loading=container.parent().loadingIcon("large"),function loadUserPaymentData(attempt_counter){attempt_counter=attempt_counter||0;$.get(URL_PURCHASE_SETUP).done(function(response){if(response.credits===undefined&&response.downloads===undefined){logged_in=response.logged_in,response.user_id,payment=response.payment||null,currency=response.currency||null,INSTANCE.dispatchEvent("load_currency",[currency]),screen_title=settings_purchase.image?settings_purchase.customization?settings_purchase.image.payment===VectorOptions.PAYMENT_SINGLEIMAGE?"Image &amp; Customization":"Pay for Customization":settings_purchase.upgrade?"License Upgrade":"Image Purchase":"Cart Purchase";var screen_title,cost_currency=settings_purchase.total_cost,cost_currency_formatted=cost_currency.toFixed(2).formatCommas(),cost_symbol="$",cost_currencystr="USD";try{cost_currency=(Math.round(100*(currency.price.gross*settings_purchase.total_cost+Math.pow(2,-52)))/100).toFixed(2),cost_currency_formatted=cost_currency.formatCommas(),cost_symbol=currency.symbol,cost_currencystr=currency.currency}catch(error){}header_title.html(screen_title+" &mdash; <small>"+cost_symbol+"</small><em>"+cost_currency_formatted+"</em><abbr>"+cost_currencystr+"</abbr>");cost_currency=payment?PaymentScreenPay.CARD_STORED:PaymentScreenPay.CARD_NEW;container.attr("data-account",1==logged_in?"member":"guest"),container.attr("data-payment",cost_currency),container.attr("data-storedcard",payment?1:""),setup(),radioboxes_payment.set(cost_currency),logged_in||setTimeout(function(){input_email.focus()},100)}else window.location.reload(!0)}).fail(function(jqXHR,textStatus,errorThrown){var log_detail;attempt_counter++<2?loadUserPaymentData(attempt_counter):(log_detail={url:URL_PURCHASE_SETUP,error:textStatus},VectorStock.log({source:"PaymentBox",provider:"Paddle",issue:"Failed to load payments setup",detail:log_detail}),INSTANCE.dispatchEvent("close"),setTimeout(function(){alert("Server unavailable - please contact customer support")},5))})}(),INSTANCE},PaymentScreenSuccess=(PaymentScreenPay.CARD_NEW="new",PaymentScreenPay.CARD_STORED="stored",function(screen,url_download,url_customization,next_step,image_license,transaction,link_account){var link_notice,login_form,but_download,but_download_label,input_username,input_password,but_login,timeout_button,but_next,but_next_label,but_return,link_email,INSTANCE=new VSModule,TIME_DISABLE_BUTTON=5*MS_MINUTE,RESPONSE_PASSWORD_INVALID="Use between 6 and 72 characters",monitor_password=!1,reload_on_close=!1;function triggerDownload(){VectorStock.goToURL(url_download)}function disableDownloadLink(){but_download&&(but_download.prop("disabled",!0).addClass("expired"),but_download_label.html("Link has now expired..."),but_download.off("click",triggerDownload))}function validatePassword(){input_password.value.length<6||72<input_password.value.length?(input_password.showError(RESPONSE_PASSWORD_INVALID),monitor_password||(input_password.on("change",validatePassword),monitor_password=!0)):input_password.clearError()}function formValidation(event){var login_process;event.preventDefault(),validatePassword(),input_password.hasError()?VectorStock.track("event","Error (User)",{type:"Login",details:"Client: Password"}):(input_password.disable(),but_login.setLoading("Logging inâ€¦"),but_close.hide(),INSTANCE.dispatchEvent("disable"),(login_process=new ProcessLogin(input_username,input_password)).on("success",function(response){but_close.show(),INSTANCE.dispatchEvent("enable"),link_notice.html("<p>You have successfully logged in! We have saved this vector to your account.</p>"),login_form.replaceWith("<figure></figure>"),reload_on_close=!0}),login_process.on("revert",function(response){input_password.enable(),but_login.revert(),but_close.show(),INSTANCE.dispatchEvent("enable")}),login_process.on("error_password",function(message){input_password.showError(message)}))}return INSTANCE.show=function(){screen.addClass("show")},INSTANCE.hide=function(){timeout_button&&clearTimeout(timeout_button),screen.removeClass("show")},INSTANCE.close=function(){reload_on_close&&window.location.reload(!0)},link_account?(screen.attr("data-type","login").append('<div class="header"><h1>Payment Success!</h1></div><div class="panel"><div class="pane reveal"><div class="feature"><div class="notice"><p><a></a> is linked to an account. Login below to save this purchased vector to your profile:</p></div><form novalidate><div class="fields"><fieldset data-field="username"><input type="text" name="username"></fieldset><fieldset data-field="password"><input type="password" name="password" maxlength="72" placeholder="Password"></fieldset></div><button type="submit"><span class="label">Login</span><span class="icon"><span></span></span></button><p><a href="/request/password">Forgot your password?</a></p></form><div class="base"><button type="button" data-action="return"><span class="label">Return to page...</span></button></div></div></div></div>'),link_notice=$(".panel .pane .notice",screen),(link_email=$("p a",link_notice)).attr("href","mailto:"+transaction.email),link_email.text(transaction.email)):url_customization!==undefined?screen.attr("data-type","customization").append('<div class="header"><h1>Payment Success!</h1></div><div class="panel"><div class="pane reveal"><div class="feature"><div class="notice"><p><span class="icon"></span>We have emailed you the invoice and download link</p></div><figure></figure><div class="base"><p>Your designer is waiting to begin!</p><button type="button" data-action="next"><span class="label">Next Step - Create a design brief...</span></button></div></div></div></div>'):screen.attr("data-type","image").append('<div class="header"><h1>Payment Success!</h1></div><div class="panel"><div class="pane reveal"><div class="feature"><div class="notice"><p><span class="icon"></span>We have emailed you the invoice and download link</p></div><figure></figure><div class="base"><button type="button" data-action="download"><span class="icon"><span class="icon_download"></span></span><span class="label">Download again</span></button><button type="button" data-action="return"><span class="label">Return to page...</span></button></div></div></div></div>'),link_email=$("> .panel .pane",screen),but_download=$('.feature button[data-action="download"]',link_email),but_download_label=$("> .label",but_download),$("> .icon",but_download),but_next=$('.feature button[data-action="next"]',link_email),but_next_label=$("> .label",but_next),but_return=$('.feature button[data-action="return"]',link_email),$("> .label",but_download),but_close=$('button[data-action="close"]',screen),link_account&&(login_form=$("form",screen),input_username=new VectorStock.FieldInput($('input[name="username"]',login_form)),input_password=new VectorStock.FieldInput($('input[name="password"]',login_form)),but_login=new VectorStock.FieldButton($('button[type="submit"]',login_form)),input_username.setValue(transaction.email)),but_download.on("click",function(){VectorStock.isMobile()?INSTANCE.dispatchEvent("view_options"):triggerDownload()}),but_next.on("click",function(){VectorStock.goToURL(url_customization)}),but_return.on("click",function(event){event.preventDefault(),INSTANCE.dispatchEvent("close")}),but_close.on("click",function(event){INSTANCE.dispatchEvent("close")}),link_account&&but_login.on("click",formValidation),url_customization!==undefined?"signup"==next_step?but_next_label.html("Next Step - Create an account..."):"login"==next_step&&but_next_label.html("Next Step - Login to your account..."):url_download||link_account?VectorStock.isMobile()&&but_download_label.html("View download options..."):(but_download.remove(),VectorStock.isLoggedIn()&&$('<button type="button" data-action="download"><span class="label">View files for download...</span></button>').prependTo(".feature .base",link_email).on("click",function(){VectorStock.goToURL("/transactions")})),VectorStock.trackPurchase(transaction.type,transaction.id,transaction.value,transaction.email,transaction.country,transaction.provider,transaction.txn_id,transaction.currency_type,image_license),window.gtag&&gtag("event","conversion",{send_to:"AW-1056033416/zSYfCJKlw_cBEIiVx_cD",value:parseInt(transaction.value),currency:transaction.currency_type,transaction_id:transaction.txn_id}),but_download.length&&(timeout_button=setTimeout(disableDownloadLink,TIME_DISABLE_BUTTON)),INSTANCE.show(),url_download&&!VectorStock.isMobile()&&triggerDownload(),INSTANCE}),PaymentBox=function(settings_image,settings_purchase,settings_customization){var image,images,overlay,container,screen_pay,screen_success,imageset,sidebar_points,timeout_session_expiry,imageset_height,INSTANCE=new VSModule,HTML_TEMPLATE=(Array.isArray(settings_image)?images=settings_image:image=settings_image,'<div id="box-payment"><div class="pb-wrap"><div class="pb-sidebar"><div class="pb-screen"><div class="pb-content"><div class="imageset" data-images="1"></div><ul></ul></div><div class="pb-background"></div></div></div><div class="pb-screens"><div class="pb-screen" data-screen="pay" data-account="" data-payment="" data-expanded=""><div class="header"><h1></h1></div><div class="panel"><div class="pane reveal"><div id="pbox_details_card"><div id="pbox_payment_new_contact" class="step"><h2><span class="title">Contact Details</span></h2><div class="fieldgroup" data-id="email"><fieldset data-field="email"><span class="icon"></span><input type="email" name="email" maxlength="100" autocomplete="email" autocorrect="off" autocapitalize="off" placeholder="Email address"></fieldset></div></div><div id="pbox_payment_card_select"  class="step"><h2><span class="title">Select payment option</span></h2><ul class="radiobuttons"><li><label for="pbox_payment_stored"><input type="radio" id="pbox_payment_stored" name="pbox_payment" value="stored"><span class="title">Use saved option</span></label></li><li><label for="pbox_payment_new"><input type="radio" id="pbox_payment_new" name="pbox_payment" value="new"><span class="title">New option</span></label></li></ul></div><div id="pbox_payment_type_store" class="step"><h2><span class="title">Payment Preference</span></h2><div class="input_checkbox"><label for="pay-remember-payment" class="checkbox"><span class="box"><input type="checkbox" id="pay-remember-payment" name="remember_payment" value="1"></span><span class="title">Save your payment details</span></label></div></div></div></div><div class="pane"><div class="pbox_paddle_form"></div></div></div><div class="footer" data-method="creditcard"><button type="submit" id="pbox-but-process-card" class="buy"><span class="label">Pay Now</span><span class="icon"></span></button><button type="submit" id="pbox-but-load-form"><span class="label">Checkout Now</span><span class="icon"></span></button></div><button data-action="close" type="button">Close</button></div><div class="pb-screen" data-screen="success"><button data-action="close" type="button">Close</button></div></div></div></div>'),HTML_BANNER='<div class="pb-banner"><button type="button"><span class="label">You can also <strong>buy with Credits</strong> for <strong>$1 per image...</strong></span><span class="icon"></span></button></div>',IS_PRODUCTION=VectorStock.isProduction(),URL_FAILOVER_INCREMENT="/api/paddle/declined",CHECKOUT_ERRORS=["payment_failure"],paddle_reloaded=(IS_PRODUCTION||CHECKOUT_ERRORS.push("3DSFailed"),!1);function setup(){if(!PaymentBox.paddle_setup){if(!window.Paddle)return void(paddle_reloaded?(alert("The payment processor is unavailable at this time. Please reload the page and try again or contact our support team."),INSTANCE.close()):(setTimeout(setup,5e3),paddle_reloaded=!0));IS_PRODUCTION||Paddle.Environment.set("sandbox"),Paddle.Setup({vendor:IS_PRODUCTION?VectorStock.paddle_id_production:VectorStock.paddle_id_sandbox,eventCallback:function(data){switch(data.event){case"Checkout.Complete":var passthrough=JSON.parse(data.eventData.checkout.passthrough);PaymentBox.instance.validateOrder(passthrough.invoice_id);break;case"Checkout.Close":PaymentBox.instance.revertLoadingState();break;case"Checkout.Location.Submit":case"Checkout.Loaded":var passthrough=data.eventData.checkout.prices.customer.total,price_currency=data.eventData.checkout.prices.customer.currency,price_tax=data.eventData.checkout.prices.customer.total_tax;PaymentBox.instance.updateTotalPrice(passthrough,price_currency,price_tax);break;case"Checkout.Error":passthrough={type:data.eventData.error_type,method:data.eventData.error_method,error:data.eventData.error,product:data.eventData.product,user:data.eventData.user};VectorStock.log({source:"PaymentBox",provider:"Paddle",issue:"Checkout Error",detail:passthrough}),CHECKOUT_ERRORS.includes(data.eventData.error_type)&&$.post(URL_FAILOVER_INCREMENT).done(function(response){var is_safari,query_string;response.success&&(is_safari=navigator.vendor&&-1<navigator.vendor.indexOf("Apple")&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS"),alert("Payment failed again - let's try another payment provider to see if that can process your credit card.\n\nClick "+(is_safari?"Close":"Ok")+" to reload the page."),is_safari=window.location.pathname+window.location.search,window.location.pathname.match(/^\/royalty-free-vector\/(.+)-(\d+)$/)&&(query_string=["license="+settings_image.license,"payment="+settings_image.payment],settings_customization&&query_string.push("cusomization=1"),is_safari=window.location.pathname+"?"+query_string.join("&")+"&launch_payment=1"),VectorStock.goToURL(is_safari))}).fail(function(jqXHR,textStatus,errorThrown){var log_detail={type:data.eventData.error_type,method:data.eventData.error_method,product:data.eventData.product,user:data.eventData.user,error:textStatus};VectorStock.log({source:"PaymentBox",provider:"Paddle",issue:"Failover increment call failed",detail:log_detail})})}}}),PaymentBox.paddle_setup=!0}var banner,sidebar;if(overlay=$('<div class="overlay" />').css({height:$(document).height()}).appendTo("body").on("click",onClickOverlay),setTimeout(function(){overlay.addClass("reveal")}),container=$(HTML_TEMPLATE).appendTo(overlay),sidebar=$(".pb-sidebar",container),sidebar=$(".pb-screen",sidebar).show(),sidebar=$(".pb-content",sidebar),sidebar_points=$("ul",sidebar),screens=$(".pb-screens",container),images)for(var total_previews=Math.min(5,images.length),i=(imageset=$(".imageset",sidebar).attr("data-images",total_previews),total_previews);i--;)addImage(images[i].id,images[i].title);else imageset=$(".imageset",sidebar).attr("data-images",1),addImage(image.id,image.title);screen_pay=new PaymentScreenPay($('.pb-screen[data-screen="pay"]',screens),images?{total_cost:settings_purchase.total_cost}:{image:image,customization:settings_customization,total_cost:settings_purchase.total_cost,upgrade:settings_purchase.upgrade}),settings_customization||(container.addClass("upsell").append(HTML_BANNER),banner=$(".pb-banner button",container)),screen_pay.on("load_currency",updateSidebar),screen_pay.on("disable",disableBox),screen_pay.on("enable",enableBox),screen_pay.on("validate",function(){var image_count=images?images.length:1;$("#sb_login").trigger("addTransactions",[image_count,!0])}),screen_pay.on("purchase",onPurchase),screen_pay.on("close",INSTANCE.close),settings_purchase.upgrade?banner.parent().remove():banner&&banner.on("click",function(event){var min_cost;VectorStock.isLoggedIn()?(min_cost=Math.max(30,5*Math.ceil(Math.round(settings_purchase.total_cost)/5)),images?VectorStock.goToURL("/purchase/credits/"+min_cost):VectorStock.goToURL("/purchase/credits/"+min_cost+"?id="+image.id)):(INSTANCE.close(),VectorStock.goToURL("/signup"))}),$(document).on("keypress",onKeyPress),$(window).height()<container.height()&&$(window).scrollTop(container.position().top),setTimeout(function(){container.addClass("reveal")}),VectorStock.isLoggedIn()&&(timeout_session_expiry=setTimeout(SignupBox.extendSession,SignupBox.TIME_EXPIRE)),images?(total_previews={cart_tally:settings_purchase.total_images,cart_value:settings_purchase.total_cost},EventTracker.track(EventTrackerLogger.ID_LOG,{source:"Cart Popup",event:"Initiated",cart:total_previews})):(sidebar={id:image.id,value:settings_purchase.total_cost},EventTracker.track(EventTrackerLogger.ID_LOG,{source:"Purchase Popup",event:"Initiated",image:sidebar},!0)),PaymentBox.instance=INSTANCE}function updateSidebar(currency){var cost_symbol="$",cost_currency="USD",cost_currency_text="United States Dollars",cost_total=settings_purchase.total_cost,cost_total_formatted=cost_total.toFixed(2).formatCommas(),cost_total_symbol="$",cost_total_currency="USD";try{cost_symbol=currency.display_symbol,cost_currency=currency.display_currency,cost_currency_text=currency.display_text,cost_total_formatted=(cost_total=(Math.round(100*(currency.price.gross*settings_purchase.total_cost+Math.pow(2,-52)))/100).toFixed(2)).formatCommas(),cost_total_symbol=currency.symbol,cost_total_currency=currency.currency}catch(error){VectorStock.log({source:"PaymentBox",provider:"Paddle",issue:"Currency object malformed",detail:{currency:currency,error:error}})}cost_total=0<currency.price.tax?" (inc. tax)":"";if(images){for(var sb_html="",licenses={standard:{count:0,cost:null},editorial:{count:0,cost:null},expanded:{count:0,cost:null},exclusive:{count:0,cost:null}},i=0;i<images.length;i++)licenses[images[i].license].count++,licenses[images[i].license].cost||(licenses[images[i].license].cost=images[i].cost);var license_type,license_cost,license_type_label,type_count=0;for(license_type in licenses)licenses[license_type].count&&(license_cost=(licenses[license_type].cost*licenses[license_type].count).toFixed(2).formatCommas(),license_type_label=license_type.toTitleCase()+" "+("exclusive"===license_type?"buyout":"license"),sb_html+='<li><span class="dt">'+licenses[license_type].count+"&times; "+license_type_label+'</span><span class="dm"></span><span class="dd"><small>'+cost_symbol+"</small><em>"+license_cost+'</em> <abbr title="'+cost_currency_text+'">'+cost_currency+"</abbr></span></li>",type_count++);1<type_count&&(sb_html+='<li class="total"><span class="dt">Subtotal</span><span class="dm"></span><span class="dd"><small>'+cost_symbol+"</small><em>"+settings_purchase.total_cost.toFixed(2).formatCommas()+'</em> <abbr title="'+cost_currency_text+'">'+cost_currency+"</abbr></span></li>"),sb_html+='<li class="total"><span class="dt">Total'+cost_total+'</span><span class="dm"></span><span class="dd"><small>'+cost_total_symbol+"</small><em>"+cost_total_formatted+"</em> <abbr>"+cost_total_currency+"</abbr></span></li>"}else{var customization_cost_formatted,license_cost_formatted,sb_html="";settings_customization?(customization_cost_formatted=settings_customization.cost.toFixed(2).formatCommas(),image.license?(sb_html=image.payment===VectorOptions.PAYMENT_CREDITS?sb_html+('<li><span class="dt">'+image.license.toTitleCase()+' License</span><span class="dm"></span><span class="dd"><em>'+image.cost)+'</em> <abbr title="VectorStock Credits">CR</abbr></span></li><li><span class="dt">Image Customization</span><span class="dm"></span><span class="dd"><small>'+cost_symbol+"</small><em>"+customization_cost_formatted+'</em> <abbr title="'+cost_currency_text+'">'+cost_currency+"</abbr></span></li>":image.payment===VectorOptions.PAYMENT_SUBSCRIPTION?sb_html+('<li><span class="dt">'+image.license.toTitleCase()+' License</span><span class="dm"></span><span class="dd"><em>'+image.cost)+'</em> <abbr title="Subscription Download">DL</abbr></span></li><li><span class="dt">Image Customization</span><span class="dm"></span><span class="dd"><small>'+cost_symbol+"</small><em>"+customization_cost_formatted+'</em> <abbr title="'+cost_currency_text+'">'+cost_currency+"</abbr></span></li>":(license_cost_formatted=image.cost.toFixed(2).formatCommas(),sb_html+('<li><span class="dt">'+image.license.toTitleCase())+' License</span><span class="dm"></span><span class="dd"><small>'+cost_symbol+"</small><em>"+license_cost_formatted+'</em> <abbr title="'+cost_currency_text+'">'+cost_currency+'</abbr></span></li><li><span class="dt">Customization</span><span class="dm"></span><span class="dd"><small>'+cost_symbol+"</small><em>"+customization_cost_formatted+'</em> <abbr title="'+cost_currency_text+'">'+cost_currency+"</abbr></span></li>"),sb_html+='<li class="total"><span class="dt">Total'+cost_total+'</span><span class="dm"></span><span class="dd"><small>'+cost_total_symbol+"</small><em>"+cost_total_formatted+"</em> <abbr>"+cost_total_currency+"</abbr></span></li>"):sb_html=sb_html+'<li><span class="dt">Image Customization</span><span class="dm"></span><span class="dd"><small>'+cost_symbol+"</small><em>"+customization_cost_formatted+'</em> <abbr title="'+cost_currency_text+'">'+cost_currency+'</abbr></span></li><li class="total"><span class="dt">Total'+cost_total+'</span><span class="dm"></span><span class="dd"><small>'+cost_total_symbol+"</small><em>"+cost_total_formatted+"</em> <abbr>"+cost_total_currency+"</abbr></span></li>"):(license_cost_formatted=image.cost.toFixed(2).formatCommas(),sb_html=sb_html+('<li><span class="dt">'+image.license.toTitleCase())+' License</span><span class="dm"></span><span class="dd"><small>'+cost_symbol+"</small><em>"+license_cost_formatted+'</em> <abbr title="'+cost_currency_text+'">'+cost_currency+'</abbr></span></li><li class="total"><span class="dt">Total'+cost_total+'</span><span class="dm"></span><span class="dd"><small>'+cost_total_symbol+"</small><em>"+cost_total_formatted+"</em> <abbr>"+cost_total_currency+"</abbr></span></li>")}sidebar_points.html(sb_html)}function disableBox(){overlay.off("click",onClickOverlay)}function enableBox(){overlay.on("click",onClickOverlay)}function addImage(image_id,image_title){var images=VectorStock.previewImagePath(image_id,image_title),picture=$("<picture />").appendTo(imageset),image=($('<source type="image/webp" srcset="'+images.webp[1]+" 2x, "+images.webp[0]+' 1.5x">').appendTo(picture),$('<source type="image/jpeg" srcset="'+images.jpeg[1]+" 2x, "+images.jpeg[0]+' 1.5x">').appendTo(picture),$('<img src="'+images.jpeg[0]+'" alt="'+(image_title||"")+'">').appendTo(picture));image[0].complete&&0!==image[0].naturalHeight?updateImagesetHeight(image.height()):image.one("load",function(){updateImagesetHeight(image.height())})}function updateImagesetHeight(image_height){var height=Math.max(image_height,imageset_height||0);height!==imageset_height&&(imageset_height=height,imageset.css({height:imageset_height+"px"}))}function onClickOverlay(event){$(event.target)[0]==overlay[0]&&INSTANCE.close()}function onKeyPress(event){"Escape"===event.key&&(INSTANCE.close(),event.stopPropagation())}function onPurchase(response,link_account,image_license){enableBox(),screen_pay.hide();var url_customization,next_step,url_download=response.url;"zip"!==settings_purchase.filetype&&response.file_urls&&response.file_urls[settings_purchase.filetype]&&(url_download=response.file_urls[settings_purchase.filetype]),settings_customization&&response.customization&&(url_customization=response.customization.url,next_step=response.customization.status),(screen_success=new PaymentScreenSuccess($('.pb-screen[data-screen="success"]',screens),url_download,url_customization,next_step,image_license,response.transaction,link_account)).on("view_options",function(){INSTANCE.dispatchEvent("view_options"),INSTANCE.close()}),screen_success.on("disable",disableBox),screen_success.on("enable",enableBox),screen_success.on("close",function(){INSTANCE.close()}),images?EventTracker.track(EventTrackerLogger.ID_LOG,{source:"Cart Popup",event:"Purchased"}):EventTracker.track(EventTrackerLogger.ID_LOG,{source:"Purchase Popup",event:"Purchased"}),INSTANCE.dispatchEvent("purchase",[response,image_license,settings_purchase.total_cost])}return INSTANCE.close=function(){screen_pay&&screen_pay.close(),screen_success&&screen_success.close(),container&&container.remove(),overlay&&overlay.remove(),timeout_session_expiry&&clearTimeout(timeout_session_expiry),screen_pay&&screen_pay.validating&&$("#sb_login").trigger("showTransactionsPrompt","Your payment is still being processed - the vector download will be available here once completed."),INSTANCE.dispatchEvent("close")},INSTANCE.updateTotalPrice=function(total,currency,tax){var sb_total=$("li.total",sidebar_points);$(".dd em",sb_total).html(total),$(".dd abbr",sb_total).html(currency),$(".dt",sb_total).html(0<tax?"Total (inc. tax)":"Total"),screen_pay.updateTotalPrice(total,currency)},INSTANCE.validateOrder=function(order_id){screen_pay.validateOrder(order_id)},INSTANCE.revertLoadingState=function(){screen_pay.revertLoadingState()},window.Paddle?setup():VectorStock.loadPaddle(setup,function(){alert("The payment processor is unavailable at this time. Please reload the page and try again or contact our support team."),INSTANCE.close()}),INSTANCE};PaymentBox.paddle_setup=!1,PaymentBox.instance=null;